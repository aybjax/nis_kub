FROM golang:1.20-alpine AS build
WORKDIR /home
COPY  . .
RUN go build -o exec

FROM alpine
WORKDIR /home
COPY --from=build /home/exec /home/app

ARG DEFAULT_NATS_URL "localhost:4222"
ENV NATS_URL $DEFAULT_NATS_URL

ARG DEFAULT_REDIS_URL "localhost:6379"
ENV REDIS_URL $DEFAULT_REDIS_URL

ARG DEFAULT_MONGO_URL "localhost:27017"
ENV MONGO_URL $DEFAULT_MONGO_URL

ENV MONGO_USER $DEFAULT_MONGO_USER ""

ENV MONGO_PASSWORD $DEFAULT_MONGO_PASSWORD ""

ARG DEFAULT_GRPC_STUDENT_URL "localhost:50052"
ENV GRPC_STUDENT_URL $DEFAULT_GRPC_STUDENT_URL

EXPOSE 8080
EXPOSE 50051

CMD ["./app"]
